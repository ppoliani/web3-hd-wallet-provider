{"version":3,"sources":["webpack://web3-hd-wallet-provider/webpack/universalModuleDefinition","webpack://web3-hd-wallet-provider/webpack/bootstrap","webpack://web3-hd-wallet-provider/external \"os\"","webpack://web3-hd-wallet-provider/external \"events\"","webpack://web3-hd-wallet-provider/external \"websocket\"","webpack://web3-hd-wallet-provider/./src/index.js","webpack://web3-hd-wallet-provider/external \"util\"","webpack://web3-hd-wallet-provider/external \"url\"","webpack://web3-hd-wallet-provider/external \"assert\"","webpack://web3-hd-wallet-provider/external \"punycode\"","webpack://web3-hd-wallet-provider/external \"buffer\"","webpack://web3-hd-wallet-provider/external \"crypto\"","webpack://web3-hd-wallet-provider/external \"http\"","webpack://web3-hd-wallet-provider/external \"https\"","webpack://web3-hd-wallet-provider/external \"stream\"","webpack://web3-hd-wallet-provider/external \"bindings\""],"names":["root","factory","exports","module","require","define","amd","global","__WEBPACK_EXTERNAL_MODULE__95__","__WEBPACK_EXTERNAL_MODULE__148__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","singletonNonceSubProvider","NonceSubProvider","HDWalletProvider","mnemonic","provider","options","_this","this","_classCallCheck","_options$address_inde","address_index","_options$num_addresse","num_addresses","_options$shareNonce","shareNonce","_options$wallet_hdpat","wallet_hdpath","http_headers","hdwallet","wallets","addresses","engine","ProviderEngine","privateKeys","Array","isArray","includes","normalizePrivateKeys","privateKey","Buffer","from","replace","ethUtil","isValidPrivate","wallet","ethJSWallet","fromPrivateKey","address","getAddressString","push","ethUtilValidation","hdkey","fromMasterSeed","bip39","mnemonicToSeed","validateMnemonic","Error","derivePath","getWallet","addr","concat","getAddress","toString","checkBIP39Mnemonic","tmp_accounts","tmp_wallets","addProvider","HookedSubprovider","getAccounts","cb","getPrivateKey","signTransaction","txParams","pkey","toLowerCase","tx","Transaction","sign","serialize","signMessage","_ref","data","dataIfExists","dataBuff","toBuffer","msgHashBuff","hashPersonalMessage","sig","ecsign","toRpcSig","v","signPersonalMessage","apply","arguments","FiltersSubprovider","ProviderSubprovider","Web3","providers","HttpProvider","_objectSpread","keepAlive","start","_len","length","args","_key","sendAsync","_len2","_key2","send","idx","debug"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"bindings\"), require(\"websocket\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"web3-hd-wallet-provider\", [\"bindings\", \"websocket\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"web3-hd-wallet-provider\"] = factory(require(\"bindings\"), require(\"websocket\"));\n\telse\n\t\troot[\"web3-hd-wallet-provider\"] = factory(root[\"bindings\"], root[\"websocket\"]);\n})(global, function(__WEBPACK_EXTERNAL_MODULE__95__, __WEBPACK_EXTERNAL_MODULE__148__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 158);\n","module.exports = require(\"os\");","module.exports = require(\"events\");","module.exports = __WEBPACK_EXTERNAL_MODULE__148__;","import bip39 from 'bip39';\nimport ethJSWallet from 'ethereumjs-wallet';\nimport hdkey from 'ethereumjs-wallet/hdkey';\nimport ProviderEngine from 'web3-provider-engine';\nimport FiltersSubprovider from 'web3-provider-engine/subproviders/filters.js';\nimport NonceSubProvider from 'web3-provider-engine/subproviders/nonce-tracker.js';\nimport HookedSubprovider from 'web3-provider-engine/subproviders/hooked-wallet.js';\nimport ProviderSubprovider from 'web3-provider-engine/subproviders/provider.js';\nimport Web3 from 'web3';\nimport Transaction from 'ethereumjs-tx';\nimport ethUtil from 'ethereumjs-util';\n\n// This line shares nonce state across multiple provider instances. Necessary\n// because within truffle the wallet is repeatedly newed if it's declared in the config within a\n// function, resetting nonce from tx to tx. An instance can opt out\n// of this behavior by passing `shareNonce=false` to the constructor.\n// See issue #65 for more\nconst singletonNonceSubProvider = new NonceSubProvider();\n\nclass HDWalletProvider {\n  constructor(\n    mnemonic,\n    provider,\n    options,\n  ) {\n    const {\n      address_index = 0,\n      num_addresses = 1,\n      shareNonce = true,\n      wallet_hdpath = \"m/44'/60'/0'/0/\",\n      http_headers\n    } = options;\n\n    this.hdwallet;\n    this.wallet_hdpath = wallet_hdpath;\n    this.http_headers = http_headers;\n    this.wallets = {};\n    this.addresses = [];\n    this.engine = new ProviderEngine();\n\n    // private helper to normalize given mnemonic\n    const normalizePrivateKeys = mnemonic => {\n      if (Array.isArray(mnemonic)) return mnemonic;\n      else if (mnemonic && !mnemonic.includes(\" \")) return [mnemonic];\n      // if truthy, but no spaces in mnemonic\n      else return false; // neither an array nor valid value passed;\n    };\n\n    // private helper to check if given mnemonic uses BIP39 passphrase protection\n    const checkBIP39Mnemonic = mnemonic => {\n      this.hdwallet = hdkey.fromMasterSeed(bip39.mnemonicToSeed(mnemonic));\n\n      if (!bip39.validateMnemonic(mnemonic)) {\n        throw new Error(\"Mnemonic invalid or undefined\");\n      }\n\n      // crank the addresses out\n      for (let i = address_index; i < address_index + num_addresses; i++) {\n        const wallet = this.hdwallet\n          .derivePath(this.wallet_hdpath + i)\n          .getWallet();\n        const addr = `0x${wallet.getAddress().toString(\"hex\")}`;\n        this.addresses.push(addr);\n        this.wallets[addr] = wallet;\n      }\n    };\n\n    // private helper leveraging ethUtils to populate wallets/addresses\n    const ethUtilValidation = privateKeys => {\n      // crank the addresses out\n      for (let i = address_index; i < address_index + num_addresses; i++) {\n        const privateKey = Buffer.from(privateKeys[i].replace(\"0x\", \"\"), \"hex\");\n        if (ethUtil.isValidPrivate(privateKey)) {\n          const wallet = ethJSWallet.fromPrivateKey(privateKey);\n          const address = wallet.getAddressString();\n          this.addresses.push(address);\n          this.wallets[address] = wallet;\n        }\n      }\n    };\n\n    const privateKeys = normalizePrivateKeys(mnemonic);\n\n    if (!privateKeys) checkBIP39Mnemonic(mnemonic);\n    else ethUtilValidation(privateKeys);\n\n    const tmp_accounts = this.addresses;\n    const tmp_wallets = this.wallets;\n\n    this.engine.addProvider(\n      new HookedSubprovider({\n        getAccounts(cb) {\n          cb(null, tmp_accounts);\n        },\n        getPrivateKey(address, cb) {\n          if (!tmp_wallets[address]) {\n            return cb(\"Account not found\");\n          } else {\n            cb(null, tmp_wallets[address].getPrivateKey().toString(\"hex\"));\n          }\n        },\n        signTransaction(txParams, cb) {\n          let pkey;\n          const from = txParams.from.toLowerCase();\n          if (tmp_wallets[from]) {\n            pkey = tmp_wallets[from].getPrivateKey();\n          } else {\n            cb(\"Account not found\");\n          }\n          const tx = new Transaction(txParams);\n          tx.sign(pkey);\n          const rawTx = `0x${tx.serialize().toString(\"hex\")}`;\n          cb(null, rawTx);\n        },\n        signMessage({ data, from }, cb) {\n          const dataIfExists = data;\n          if (!dataIfExists) {\n            cb(\"No data to sign\");\n          }\n          if (!tmp_wallets[from]) {\n            cb(\"Account not found\");\n          }\n          let pkey = tmp_wallets[from].getPrivateKey();\n          const dataBuff = ethUtil.toBuffer(dataIfExists);\n          const msgHashBuff = ethUtil.hashPersonalMessage(dataBuff);\n          const sig = ethUtil.ecsign(msgHashBuff, pkey);\n          const rpcSig = ethUtil.toRpcSig(sig.v, sig.r, sig.s);\n          cb(null, rpcSig);\n        },\n        signPersonalMessage(...args) {\n          this.signMessage(...args);\n        }\n      })\n    );\n\n    !shareNonce\n      ? this.engine.addProvider(new NonceSubProvider())\n      : this.engine.addProvider(singletonNonceSubProvider);\n\n    this.engine.addProvider(new FiltersSubprovider());\n    if (typeof provider === \"string\") {\n      // shim Web3 to give it expected sendAsync method. Needed if web3-engine-provider upgraded!\n      // Web3.providers.HttpProvider.prototype.sendAsync =\n      // Web3.providers.HttpProvider.prototype.send;\n      this.engine.addProvider(\n        new ProviderSubprovider(\n          new Web3.providers.HttpProvider(provider, { keepAlive: false, ...this.http_headers })\n        )\n      );\n    } else {\n      this.engine.addProvider(new ProviderSubprovider(provider));\n    }\n    this.engine.start(); // Required by the provider engine.\n  }\n\n  sendAsync(...args) {\n    this.engine.sendAsync.apply(this.engine, args);\n  }\n\n  send(...args) {\n    return this.engine.send.apply(this.engine, args);\n  }\n\n  // returns the address of the given address_index, first checking the cache\n  getAddress(idx) {\n    debug(\"getting addresses\", this.addresses[0], idx);\n    if (!idx) {\n      return this.addresses[0];\n    } else {\n      return this.addresses[idx];\n    }\n  }\n\n  // returns the addresses cache\n  getAddresses() {\n    return this.addresses;\n  }\n}\n\nexport default HDWalletProvider;\n","module.exports = require(\"util\");","module.exports = require(\"url\");","module.exports = require(\"assert\");","module.exports = require(\"punycode\");","module.exports = require(\"buffer\");","module.exports = require(\"crypto\");","module.exports = require(\"http\");","module.exports = require(\"https\");","module.exports = require(\"stream\");","module.exports = __WEBPACK_EXTERNAL_MODULE__95__;"],"sourceRoot":""}